<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, shrink-to-fit=no, user-scalable=no">
	<meta name="mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.0/css/all.css">
<style>

:root {
	--link-color: #fff;
	--h1-color: #cdcdcd;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body { height: 100% }
a { text-decoration:none; color:var(--link-color)}
.clear{clear:both}

.container {
  min-height: 100vh;
  font-family: Montserrat, sans-serif;
}
section {
	position: absolute;
	top: 0;
	height: 100vh;
	width: 0;
	opacity: 0;
	transition: all ease-in .5s;
/*    display: flex; */
	text-align:right;
	justify-content: right;
	align-items: right;
	padding:5vw;
}
nav {
	position: absolute;
	left: 0;
	top:0;
	z-index: 50;
	display: flex;
}
body, section {
	background:
		radial-gradient(black 15%, transparent 16%) 0 0,
		radial-gradient(black 15%, transparent 16%) 8px 8px,
		radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px,
		radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;
	background-color:#282828;
	background-size:16px 16px;
}
.sectImg{
	border-radius:4px;
	margin-bottom:20px;
	border:1px solid #fff;
}
input[type=text], select, textarea {
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}

input[type=submit] {
  background-color: #04AA6D;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

@media (orientation: landscape) {
	nav {
		height:100vh;
		flex-direction: column;
	}
	section {
		padding-top:10vh;
	}
	.sectImg{
		height:60vh;
		width:60vh;
	}
	input[type=text],input[type=submit], select, textarea {
		width:50vw
	}
	#section1{
		background: radial-gradient(ellipse at top left, #3b4775 0%, #090a0f 100%);
	}
}

@media (orientation: portrait) {
	nav {
		width:100vw;
		flex-direction: row;
	}
	section {
		padding-top:100px;
	}
	.sectImg{
		height:90vw;
		width:90vw;
	}
	input[type=text],input[type=submit], select, textarea {
		width:90vw
	}
	#section1{
		background: radial-gradient(ellipse at top left, #3b4775 0%, #090a0f 100%);
	}
}

nav a {
    font-size: 50px;
    color: var(--link-color);
    text-decoration: none;
    padding: 20px;
    text-align: center;
    float:left;
}


section h1 {
    color: var(--h1-color);
    font-size: 30px;
    opacity: 0;
}

/* Styles applied on trigger */
section:target {
    opacity: 1;
    position: absolute;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 10;
}

section:target h1 {
    opacity: 0;
    animation: 2s fadeIn forwards .5s;
}

#section1 {

}

#section2 {
	background:
		radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 9%, hsla(0, 100%, 20%, 0) 9%) 0 0,
		radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 8%, hsla(0, 100%, 20%, 0) 10%) 50px 50px,
		radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 50px 0,
		radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 0 50px,
		radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 50px 0,
		radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 100px 50px,
		radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 0 0,
		radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 50px 50px,
		linear-gradient(45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0,
		linear-gradient(-45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0;
	background-color: #300;
	background-size: 100px 100px;
}

#section3 {

}

#section4 {
 color:#fff
}
@keyframes fadeIn {
    100% { opacity:1 }
}

</style>
</head>
<body>
	<nav>
		<a href="#section1"><i class="far fa-address-card"></i></a>
		<a href="#section2"><i class="fas fa-comment-dots"></i></a>
		<a href="#section3"><i class="fas fa-satellite-dish"></i></a>
		<a href="#section4"><i class="fab fa-watchman-monitoring"></i></a>
		<a href="javascript:toggleFullscreen()" ><i class="fa fa-expand-arrows-alt"></i></a>

	</nav>
	<div class='container'>
		<section id='section1'>
			<svg viewBox="0 0 350 150" xmlns="http://www.w3.org/2000/svg" class="sectImg" style="height:20vh;border-radius:15px 15px 0 0;margin-bottom:0">
				<style>
					.texts { font: bold italic 23px serif; fill: #fff;}
				</style>
				<text x="10"  y="40"  class="texts">ReeKol</text>
				<text x="10"  y="70"  class="texts">cupuyc@gmail.com</text>
				<text x="10"  y="100" class="texts">https://github.com/reekol</text>
				<text x="10"  y="130" class="texts">vCard: &#8675;&#8675;&#8675;</text>
			</svg>

			<div class="clear" ></div>
			<a href="https://raw.githubusercontent.com/reekol/reekol.github.io/master/assets/vcard.vcf" download="reeKolVc">
				<img src="https://raw.githubusercontent.com/reekol/reekol.github.io/master/assets/reekol.vcard.svg" alt="Projects page" class="sectImg" style="border-radius:0 0 15px 15px;background:#fff"/>
			</a>
<!--			<img src="https://avatars.githubusercontent.com/u/19834806?v=4" alt="ReeKol" class="sectImg" />-->
		</section>

		<section id='section2'>
			<form id="formElem" >
				<input type="text" name="title" placeholder="Your name and/or e-mail..">
				<textarea name="message" placeholder="(Subject) Write something.." style="height:30vh"></textarea>
				<br />
				<input type="submit" value="Submit">
			</form>
		</section>
		<section id="section3">
		</section>
		<section id="section4">
		</section>
	</div>
<script>
d = console.log
let tracking = false;
let trackLog = document.querySelector('#section3')
let section4 = document.getElementById('section4')

const uid = Date.now()

function toggleFullscreen() {
  let elem = document.querySelector("body")
  if (!document.fullscreenElement) {
    elem.requestFullscreen().catch(err => {
      alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`)
    })
  } else {
    document.exitFullscreen()
  }
  screen.orientation.lock(screen.orientation.type) // Lock to current orientation type
}

function sendNotification(data){
	fetch("https://vetshares.com/message?token=AWEzK29G4UerQfi",{
		method: 'POST',
		headers: { 'Content-Type': 'application/json; charset=utf-8' },
		mode: 'cors',
		cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
		body: data})
}

formElem.onsubmit = async (e) => {
	e.preventDefault();
	var object = {};
	let formData = new FormData(formElem)
	formData.forEach((value, key) => { object[key] = value })
	object.priority = 8
	object.title = "MSG::" + object.title
	sendNotification(JSON.stringify(object))
}

document.body.onload = () =>{

	if(!window.location.hash) window.location.hash = 'section1'
	if(['reekol.github.io','seqr.link'].indexOf(window.location.host) === -1) return false; // list of hosts to track

	let script = document.createElement('script');
	script.src = "https://seqr.link/ip.php";
	script.onload = () => {
		sendNotification(JSON.stringify({
			"title":`VISIT :: [${window.location.host}] ${seqrIp.geoplugin_countryCode}, ${seqrIp.geoplugin_city}, ${seqrIp.geoplugin_request}`,
			"message":`${seqrIp.geoplugin_countryName}, ${seqrIp.geoplugin_city},\n ${seqrIp.agent}`,
			"priority":9,
			"extras": {
				"client::notification": {
					"click": { "url": "https://vetshares.com" }
				}
			}
		}))
	}
	document.head.append(script)
}


function geoSuccess(position) {
	const latitude  = position.coords.latitude;
	const longitude = position.coords.longitude;

	let msg = `Latitude: ${latitude} °, Longitude: ${longitude} °\n`
			+ `https://www.openstreetmap.org/#map=18/${latitude}/${longitude}`
	if(typeof seqrIp !== 'undefined'){
			msg += `\n===================\n`
				+ `Ip: ${seqrIp.geoplugin_request}.\n`
				+ `Country: ${seqrIp.geoplugin_countryName}.\n`
				+ `City: ${seqrIp.geoplugin_city}.\n`
				+ `Agent: ${seqrIp.agent}.`
	}

  	sendNotification(JSON.stringify({
  		"title":`ALERT [${window.location.host}]`,
  		"message":msg,
  		"priority":9,
  		"extras": {
  			"client::notification": {
  				"click": { "url": `https://www.openstreetmap.org/#map=18/${latitude}/${longitude}` }
  			}
  		}
  	}))

	let log = `<h3><a target="_new" href="https://www.openstreetmap.org/#map=18/${latitude}/${longitude}" >`
			+  new Date().toISOString().replace('T',' ') + ' '
			+  `Lat: ${latitude}/ Lon: ${longitude}`
			+  `</a></h3>`

	trackLog.innerHTML =log + "\n" + trackLog.innerHTML
	setTimeout(geoFindMe,10000)
}

function geoError() {
	status.textContent = 'Unable to retrieve your location';
}

function geoFindMe() {
  if(!navigator.geolocation) {
    d('Geolocation is not supported by your browser')
  } else {
    navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
  }

}


function showNotif(msg){
	d(msg)
	section4.innerHTML += msg + "\n<hr/>\n";// + section4.innerHTML
	new Notification(msg)
}

function notifyMe(msg) {
  if (!("Notification" in window)) {
    alert("This browser does not support desktop notification");
  }
  else if (Notification.permission === "granted") {
    showNotif(msg)
  }
  else if (Notification.permission !== "denied") {
    Notification.requestPermission().then(function (permission) {
      if (permission === "granted") showNotif(msg)
    })
  }
}

let connectSocket = () => {
    let wss = new WebSocket("wss://vetshares.com/stream?token=CfMLL-9R4oI3RIQ")
    wss._retryTime  = 5000
    wss.onopen      = (e  ) => {  }
    wss.onmessage   = (e  ) => { let msg = JSON.parse(e.data); d(msg); notifyMe(msg.title + '\n' + msg.message)}
    wss.onclose     = (   ) => {  }
    wss.onerror     = (e  ) => {  }
    wss.sendJson    = (msg) => {  }
}

document.querySelector('.fa-satellite-dish').addEventListener('click',e => {
	if(tracking) return
	tracking = true
	e.target.style.color = '#f00'
	geoFindMe()
})

document.querySelector('.fa-watchman-monitoring').addEventListener('click',e => {
	if(tracking) return
	tracking = true
	e.target.style.color = '#0f0'
	connectSocket()
})

</script>
</body>
</html>
